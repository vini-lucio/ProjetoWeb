{% extends "home/base.html" %}

{% block conteudo %}

    {% if dados.confere_pedidos %}
        <section class="principal principal-escuro">
            <div class="dashboard-vendas-conteudo dashboard-vendas-conteudo-escuro">
                <div class="moldura-vermelha-dashboard div-dashboard-erros principal-escuro-2">
                    <div class="div-dashboard">
                        <p class="fonte-vermelho">ERROS</p>
                    </div>
                    {% for pedido in dados.confere_pedidos %}
                        <p><span class="fonte-verde">{{ pedido.PEDIDO }} - {{ pedido.CONSULTOR }}</span> - {{ pedido.ERRO }}</p>
                    {% endfor %}
                </div>
            </div>
        </section>
    {% endif %}

    <section class="principal principal-escuro">

        <div class="link-conteudo link-conteudo-escuro">
            <div class="titulo">
                <h1>{{  titulo_pagina  }}</h1>
            </div>

            <form method="get">
                <div class="grid-simples link-conteudo link-conteudo-escuro">
                    {{ formulario.as_p }}
                </div>
                <div class="grid-simples">
                    <button class="botao botao-escuro" name="submit" type="submit">Atualizar</button>
                </div>
            </form>
        </div>

        

        <div class="link-conteudo link-conteudo-escuro">

            {% if erros %}
                <p>{{ erros }}</p>
            {% endif %}

            {% if dados %}

                <div class="grid">

                    <div class="moldura-verde-dashboard-2 principal-escuro-2 alinhar-topo" style="{% if dados.porcentagem_meta_mes >= 100 %}border:0.4rem solid var(--roxo-rentabilidade-2){% endif %}">
                        <div style="position: relative;">
                            <div class="centralizar fonte-muito-pequena-dashboard" style="width: 100%; position: absolute; z-index: 2;">
                                {{ dados.rentabilidade_pedidos_mes_rentabilidade_mes | floatformat:"2" }}%*
                            </div>
                            <div class="grafico-barra" style="position: relative; z-index: 1; --largura: {% if dados.porcentagem_meta_mes > 100 %}100{% else %}{{ dados.porcentagem_meta_mes }}{% endif %}%; --cor-barra: {% if dados.rentabilidade_pedidos_mes_rentabilidade_mes != 0 %}var({{ dados.cor_rentabilidade_css_mes }}){% else %}transparent{% endif %}"></div>
                        </div>
                        <div class="flex">
                            <div>
                                <p>Meta Mes</p>
                            </div>
                            <div>
                                <p>R$ {{ dados.pedidos_mes | floatformat:"2" }} / <span class="fonte-verde">R$ {{ dados.meta_mes | floatformat:"2" }}</span></p>
                            </div>
                            <div>
                                <p><span class="fonte-vermelho">(R$ {{ dados.faltam_meta_mes | floatformat:"2" }})</span></p>
                            </div>
                        </div>
                    </div>

                    <div class="moldura-verde-dashboard-2 principal-escuro-2 alinhar-topo" style="{% if dados.porcentagem_meta_dia >= 100 %}border:0.4rem solid var(--roxo-rentabilidade-2){% endif %}">
                        <div style="position: relative;">
                            <div class="centralizar fonte-muito-pequena-dashboard" style="width: 100%; position: absolute; z-index: 2;">
                                {{ dados.rentabilidade_pedidos_dia | floatformat:"2" }}%*
                            </div>
                            <div class="grafico-barra" style="position: relative; z-index: 1; --largura: {% if dados.porcentagem_meta_dia > 100 %}100{% else %}{{ dados.porcentagem_meta_dia }}{% endif %}%; --cor-barra: {% if dados.rentabilidade_pedidos_dia != 0 %}var({{ dados.cor_rentabilidade_css_dia }}){% else %}transparent{% endif %}"></div>
                        </div>
                        <div class="flex">
                            <div>
                                <p>Meta Dia</p>
                            </div>
                            <div>
                                <p>R$ {{ dados.pedidos_dia | floatformat:"2" }} / <span class="fonte-verde">R$ {{ dados.meta_diaria | floatformat:"2" }}</span></p>
                            </div>
                            <div>
                                <p><span class="fonte-vermelho">(R$ {{ dados.faltam_meta_dia | floatformat:"2" }})</span></p>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="moldura-verde-dashboard grid principal-escuro-2">
                    <div>
                        <p class="fonte-verde">Conversão de Orç.*¹</p>
                        <p>{{ dados.conversao_de_orcamentos | floatformat:"2" }}%</p>
                    </div>
                    <div>
                        <p class="fonte-verde">Faltam Orç. Dia*²</p>
                        <p>R$ {{ dados.faltam_abrir_orcamentos_dia | floatformat:"2" }}</p>
                    </div>
                </div>

                <div class="div-dashboard principal-escuro">
                    <p>Atualizado em: {{ dados.data_hora_atual }}</p>
                </div>
    
                <div class="div-dashboard principal-escuro">
                    <p class="fonte-muito-pequena-dashboard">Faltam R$ {{ dados.falta_mudar_cor_mes_valor | floatformat:"2" }} com margem de {{ dados.falta_mudar_cor_mes_valor_rentabilidade | floatformat:"2" }}% para {{ dados.falta_mudar_cor_mes_cor }} no mês. ({{ dados.falta_mudar_cor_mes_porcentagem | floatformat:"2" }})</p>
                    <p class="fonte-muito-pequena-dashboard">*¹ Ultimos 90 dias</p>
                    <p class="fonte-muito-pequena-dashboard">*² Novos orçs. para a meta do dia</p>
                </div>

            {% endif %}

        </div>

    </section>

{% endblock conteudo %}